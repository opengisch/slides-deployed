<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Qgis Relations Miniworkshop</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="/_assets/stylesheets/softteaching-theme.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/base16/zenburn.css" />

    <link rel="stylesheet" href="./_assets/slides/stylesheets/base-theme.css" />
    <link rel="stylesheet" href="./_assets/slides/stylesheets/base-white-theme.css" />
    <link rel="stylesheet" href="./_assets/slides/stylesheets/logo_white.png" />
    <link rel="stylesheet" href="./_assets/slides/stylesheets/opengisch-bright.css" />
    <link rel="stylesheet" href="./_assets/slides/stylesheets/opengisch-dark.css" />
    <link rel="stylesheet" href="./_assets/slides/stylesheets/pitch-theme.css" />
    <link rel="stylesheet" href="./_assets/slides/stylesheets/softteaching-theme.css" />
    <link rel="stylesheet" href="./_assets/slides/stylesheets/teaching-theme.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">

<h1 style="color: var(--opengisch-light) !important;">data relations in QGIS</h1>

### Core functionalities and plugins
</script></section><section ><section data-markdown><script type="text/template">
<h1 style="-webkit-text-stroke: 2px var(--opengisch-light) !important; color: steelblue !important;">Dave Signer</h1>
<h1 style="-webkit-text-stroke: 2px var(--opengisch-light) !important; color: var(--opengisch-green) !important;">@ OPENGIS.ch</h1>

## BSc in IT(SE) @ ZHAW

### Developer, Consultant, Coordinator

<h3 style=" color: lightgrey !important;">Teacher and Storyteller</h1>

<!-- .slide: data-background="assets/about-me.png" -->

<aside class="notes">

- Senior Software Engineer @OPENGIS.ch
- Swiss company dedicated to OPEN SOURCE around 20 people
- QGIS Core and Plugin Developer
- Consultant in Data Modelling e.g. INTERLIS

</aside>

</script></section><section data-markdown><script type="text/template">

### Goals

- You **know what** QGIS Relations are
- You **know how** to configure the widgets
- You **can handle them** in QGIS
- You **know about** the possiblities of plugins

</script></section><section data-markdown><script type="text/template">

### Program

- The **data model** and the **QGIS Project** üßë‚Äçüè´
- Configure the **QGIS relations** üë™
- Configure and play with the **widgets** üë™
- The power of **plugins** ü™Ñ
- **Questions**

</script></section><section data-markdown><script type="text/template">

### Data Download

<p style="font-size:4em !important;"><b>t.ly/1s6oj</b></p>

<!-- https://drive.google.com/drive/folders/1qp0R1-2tyCm3oVupJ0xYvUseYy4geR05?usp=sharing -->
</script></section></section><section  data-markdown><script type="text/template">
## Data Model

```mermaid
%%{init: {'theme': 'dark' } }%%

erDiagram
  ADDRESS {
    string uuid
    string street
    string number
    string city
  }
  BUILDING {
    string uuid
    string name
    integer constructionyear
    geometry geom
  }
  APARTMENT {
    string uuid
    string description
    integer level
    text rooms
  }
  ALLOTMENT {
    string uuid
    string name
    geometry geom
  }
  BUILDING O|--O| ADDRESS : "one-to-one" 
  BUILDING O|--O{ APARTMENT : "one-to-many"
  ALLOTMENT |{--|{ APARTMENT : "many-to-many"
```

<aside class="notes">

A building can have none or multiple apartments, but an apartment must to be related to a building. This black box on the left describes the relation strength as a composition. An apartment cannot exist without a building. When a building is demolished, all apartments of it are demolished as well.

To an apartment one or multiple allotment gardens are possible. An allotment can be shared with multiple apartments. This is a many-to-many relation and this means, it will be normalized by adding a linking (join) table in between.

A building can have an address (only one ‚Äì no multiple entrances in this example). An address can refer to one building. Why not making one single table on a one-to-one relation? To ensure their existence independently: When a building is demolished, the address should persist until the new building is constructed.

</aside>
</script></section><section  data-markdown><script type="text/template">
## Let's go!
</script></section><section  data-markdown><script type="text/template">
## Excercise

1. Set up relation `Address_of_Building`
    > Although it's a one-to-one relation we configure it like a one-to-many relation.
2. Configure in Layer `Building` the **Relation Editor** Widget for `Address`
3. Configure in Layer `Address` the **Relation Reference** Widget for `Building`
</script></section><section  data-markdown><script type="text/template">
## many-to-many relation

```mermaid
%%{init: {'theme': 'dark' } }%%

erDiagram
  APARTMENT {
    string uuid
  }
  LINKING_TABLE {
    string allotment_uuid
    string apartment_uuid
    string ownership_type
  }
  ALLOTMENT {
    string uuid
  }
  ALLOTMENT O{--O| LINKING_TABLE : "one-to-many"
  APARTMENT O{--O| LINKING_TABLE : "one-to-many"
```
</script></section><section ><section data-markdown><script type="text/template">
## Plugins

Special plugins that **override** the behavior of the Relation Editor Widget.

- Linking Relation Editor
- Ordered Relation Editor
- Document Management System

</script></section><section data-markdown><script type="text/template">

### Abstract Class QGIS C++ Core

```c++
/**
 * Base class to build new relation widgets.
 * \ingroup gui
 * \class QgsAbstractRelationEditorWidget
 * \since QGIS 3.18
 */
class GUI_EXPORT QgsAbstractRelationEditorWidget : public QWidget
{
  [...]
```

</script></section><section data-markdown><script type="text/template">

### Available PyQGIS API

```python
from qgis.gui import QgsAbstractRelationEditorWidget

class LinkingRelationEditorWidget(QgsAbstractRelationEditorWidget, WidgetUi):
```
</script></section></section><section ><section data-markdown><script type="text/template">
## Use Case: Documents

#### We would like to append documents to

- Buildings
- Apartments
- Allotments

How do we model it?

</script></section><section data-markdown><script type="text/template">

### Opt. 1: three linking tables

```mermaid
%%{init: {'theme': 'dark' } }%%

erDiagram
  BUILDING {
    string uuid
  }
  APARTMENT {
    string uuid
  }
  ALLOTMENT {
    string uuid
  }
  LINKING_TABLE_1 {
    string document_uuid
    string building_uuid
  }
  LINKING_TABLE_2 {
    string document_uuid
    string allotment_uuid
  }
  LINKING_TABLE_3 {
    string document_uuid
    string apartment_uuid
  }
  DOCUMENT {
    string uuid
  }
  DOCUMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  BUILDING O{--O| LINKING_TABLE_1 : "one-to-many"
  DOCUMENT O{--O| LINKING_TABLE_2 : "one-to-many"
  APARTMENT O{--O| LINKING_TABLE_2 : "one-to-many"
  DOCUMENT O{--O| LINKING_TABLE_3 : "one-to-many"
  ALLOTMENT O{--O| LINKING_TABLE_3 : "one-to-many"
```

... lots of tables üò™

</script></section><section data-markdown><script type="text/template">

### Opt. 2: three FKs in one linking table

```mermaid
%%{init: {'theme': 'dark' } }%%

erDiagram
  BUILDING {
    string uuid
  }
  APARTMENT {
    string uuid
  }
  ALLOTMENT {
    string uuid
  }
  LINKING_TABLE_1 {
    string document_uuid
    string building_uuid
    string allotment_uuid
    string apartment_uuid
  }
  DOCUMENT {
    string uuid
  }
  DOCUMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  BUILDING O{--O| LINKING_TABLE_1 : "one-to-many"
  DOCUMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  APARTMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  DOCUMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  ALLOTMENT O{--O| LINKING_TABLE_1 : "one-to-many"
```

... empty FKs and mess with relations üò´

</script></section><section data-markdown><script type="text/template">

### Opt. 3: one FK in one linking table

#### ... and one layer id

```mermaid
%%{init: {'theme': 'dark' } }%%

erDiagram
  BUILDING {
    string uuid
  }
  APARTMENT {
    string uuid
  }
  ALLOTMENT {
    string uuid
  }
  LINKING_TABLE_1 {
    string document_uuid
    string feature_uuid
    string feature_layer
  }
  DOCUMENT {
    string uuid
  }
  DOCUMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  BUILDING O{--O| LINKING_TABLE_1 : "one-to-many"
  DOCUMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  APARTMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  DOCUMENT O{--O| LINKING_TABLE_1 : "one-to-many"
  ALLOTMENT O{--O| LINKING_TABLE_1 : "one-to-many"
```

Possible in QGIS üòä With **Polimorphic Relations**
</script></section></section><section  data-markdown><script type="text/template">
## Links

- The same as a blogpost

  [www.opengis.ch/blog/](https://www.opengis.ch/2022/11/29/qgis-relations-their-widgets-and-the-plugins-of-them/)

- QGIS Documentation
  
  [docs.qgis.org/3.28/](https://docs.qgis.org/3.28/en/docs/user_manual/working_with_vector/attribute_table.html?highlight=relations#creating-one-or-many-to-many-relations)

- PyQGIS API

  www.qgis.org/pyqgis/3.28/
</script></section><section  data-markdown><script type="text/template">
<h1 style="-webkit-text-stroke: 2px var(--opengisch-dark) !important; color: lightgray !important; font-size:3em !important">Questions?</h1>

<!-- .slide: data-background="assets/questions.png" -->
</script></section><section  data-markdown><script type="text/template">
### That's it

#### Web: www.opengis.ch

#### Email: <david@opengis.ch>

#### Github: github.com/opengisch

#### Mastodon: @signedav@fosstodon.org
</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        slideNumber: true,
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"transition":"none","slideNumber":false,"overview":true,"autoPlayMedia":true}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
